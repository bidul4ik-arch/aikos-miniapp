<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Шины • Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      :root{
        --bg: var(--tg-theme-bg-color, #0e1621);
        --text: var(--tg-theme-text-color, #fff);
        --hint: var(--tg-theme-hint-color, #9aa9b5);
        --link: var(--tg-theme-link-color, #2ea6ff);
        --btn: var(--tg-theme-button-color, #2ea6ff);
        --btn-text: var(--tg-theme-button-text-color, #fff);
        --sec: var(--tg-theme-secondary-bg-color, rgba(255,255,255,0.05));
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body { margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: var(--bg); color: var(--text); }
      .wrap { max-width: 980px; margin: 0 auto; padding: 12px; }
      header { display:flex; align-items:center; justify-content:space-between; gap:12px; position:sticky; top:0; padding:8px 0 12px; background: var(--bg); z-index:10; }
      .brand { display:flex; align-items:center; gap:12px; }
      .logo { width:auto; height:28px; border-radius:8px; background:transparent; padding:0; }
      .logo img{ height:28px; width:auto; display:block; }
      .title{ font-size:16px; font-weight:700; line-height:1.1; }
      .subtitle{ color:var(--hint); font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:48vw; }
      .tabs { display:flex; gap:8px; overflow:auto; padding: 6px 0 8px; }
      .tab { padding:10px 12px; border-radius:10px; background: var(--sec); cursor:pointer; font-weight:700; white-space:nowrap; }
      .tab.active { outline:2px solid color-mix(in oklab, var(--btn) 65%, transparent); }
      .filters { display:grid; grid-template-columns: repeat(auto-fill, minmax(160px,1fr)); gap:10px; margin: 8px 0 12px; }
      select, input, button { width:100%; padding:10px 12px; border-radius:12px; border:none; background: var(--sec); color: var(--text); }
      .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:12px; }
      .card { background: var(--sec); border-radius:16px; overflow:hidden; display:flex; flex-direction:column; box-shadow: 0 8px 24px rgba(0,0,0,.18); }
      .ph { width:100%; aspect-ratio: 16/10; background:#222b36; display:grid; place-items:center; font-size:40px; }
      .card-body { padding:12px; display:grid; gap:8px; }
      .row { display:flex; justify-content:space-between; align-items:center; gap:10px; }
      .badge { font-size:12px; background: rgba(255,255,255,.12); padding:4px 8px; border-radius:999px; }
      .btn { background: var(--btn); color: var(--btn-text); padding:10px 12px; border-radius:12px; border:none; font-weight:700; cursor:pointer; }
      .hint { color: var(--hint); font-size:12px; }
      .list { display:grid; gap:10px; }
      .item { background: var(--sec); padding:12px; border-radius:12px; display:grid; gap:4px; }
      .bar{ position:sticky; bottom:0; z-index:40; }
      .bar-inner { background: var(--sec); border-radius:14px; padding:10px; display:flex; align-items:center; gap:10px; }
      .spacer { flex:1; }
      .muted { color: var(--hint); font-size:12px; }
      a { color: var(--link); text-decoration: none; }
      form .row { gap:8px; }
    
      .card-img { width:100%; aspect-ratio:16/10; object-fit:cover; background:#1b2530; }
      .tabs { margin-top: 6px; }
      /* Modal viewer */
      .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:50; pointer-events:none; }
      .modal-backdrop.show{ display:flex; pointer-events:auto; }
      .modal { background: var(--sec); color: var(--text); border-radius:16px; padding:16px; width:min(560px,96vw); box-shadow:0 20px 60px rgba(0,0,0,.35); }
      .modal .row { display:flex; align-items:center; justify-content:space-between; gap:12px; }
      .close { background: rgba(255,255,255,.12); border:none; border-radius:10px; padding:8px 10px; cursor:pointer; color: var(--text); }
      .gallery { position: relative; margin-top:10px; }
      .gallery img { width:100%; aspect-ratio:16/10; object-fit:cover; border-radius:12px; background:#1b2530; }
      .nav { position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,.35); border:none; color:#fff; width:36px; height:36px; border-radius:50%; cursor:pointer; }
      .nav.prev { left:6px; } .nav.next { right:6px; }
      .thumbs { display:flex; gap:6px; margin-top:8px; overflow:auto; }
      .thumbs img { width:64px; height:48px; object-fit:cover; border-radius:8px; opacity:.75; cursor:pointer; }
      .thumbs img.active { outline:2px solid var(--btn); opacity:1; }

      header{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  position: sticky;
  top: env(safe-area-inset-top, 0);                 /* учитываем вырез/статусбар */
  padding: calc(6px + env(safe-area-inset-top,0)) 0 8px;
  background: color-mix(in oklab, var(--bg) 92%, transparent);
  z-index: 3;                                       /* ниже модалки и нижней панели */
  border-bottom: 1px solid rgba(255,255,255,.06);
  backdrop-filter: saturate(140%) blur(6px);
}
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="brand">
          <div class="logo" style="background:transparent;padding:0;"><img src="/images/logo_aikos.png" alt="Logo" style="height:40px;width:auto;display:block;" onerror="this.parentNode.textContent='TY'"></div>
          <div>
            <div class="title"></div>
            <div class="subtitle">Каталог шин • Mini App</div>
          </div>
        </div>
        <div class="subtitle" id="hello">…</div>
      </header>

      <div class="tabs" id="tabs"></div>

      <section id="catalog" style="display:none">
        <div class="filters">
          <select id="f-season"><option value="">Сезон</option></select>
          <select id="f-brand"><option value="">Бренд</option></select>
          <input id="f-width" placeholder="Ширина (напр. 205)" />
          <input id="f-aspect" placeholder="Профиль (напр. 55)" />
          <input id="f-rim" placeholder="Радиус (напр. 16)" />
          <label><input type="checkbox" id="f-stud" /> Шипы</label>
          <label><input type="checkbox" id="f-runflat" /> RunFlat</label>
          <select id="currency">
            <option value="EUR">€ EUR</option>
            <option value="KZT">₸ KZT</option>
            <option value="USD">$ USD</option>
            <option value="UZS">сўм UZS</option>
          </select>
          <select id="vat">
            <option value="with">Цена с НДС</option>
            <option value="without">Цена без НДС</option>
          </select>
        </div>
        <div class="grid" id="grid"></div>
      </section>

      <section id="fitment" style="display:none">
        <div class="filters">
          <input id="car-make" placeholder="Марка" />
          <input id="car-model" placeholder="Модель" />
          <input id="car-year" placeholder="Год" />
          <button id="btn-fitment" class="btn">Подобрать</button>
        </div>
        <p class="hint">Функция «По авто» будет подключена позже. Сейчас показываем популярные размеры: 205/55 R16, 225/45 R17.</p>
        <div class="grid" id="fitment-grid"></div>
      </section>

      <section id="delivery" style="display:none">
        <div class="filters">
          <input id="order-id" placeholder="Номер заказа (например, ORD-1234567890)" />
          <button id="btn-track" class="btn">Отследить</button>
        </div>
        <div class="item" id="track-result" style="display:none"></div>
      </section>

      <section id="branches" style="display:none">
        <div class="list" id="branches-list"></div>
      </section>

      <section id="reviews" style="display:none">
        <p class="hint">Спасибо за заказ! Оставьте отзыв на любой удобной площадке:</p>
        <div class="list" id="reviews-list"></div>
        <hr style="border:none;height:1px;background:rgba(255,255,255,.1);margin:10px 0;">
        <form id="review-form">
          <div class="row">
            <input name="name" placeholder="Ваше имя" />
            <input name="phone" placeholder="Телефон" />
          </div>
          <textarea name="text" placeholder="Ваш отзыв" style="width:100%; height:90px; padding:10px; border-radius:12px; background: var(--sec); color: var(--text); border:none;"></textarea>
          <div class="row">
            <span class="muted">Можно оставить внутренний отзыв — мы свяжемся.</span>
            <button class="btn" type="submit">Отправить</button>
          </div>
        </form>
      </section>

      <div class="bar">
        <div class="bar-inner">
          <div>
            <div><strong>Корзина</strong></div>
            <div class="muted"><span id="items-count">0</span> товар(ов)</div>
          </div>
          <div class="spacer"></div>
          <button id="btn-checkout" class="btn">Оформить</button>
        </div>
      </div>
    </div>

    <script type="module" src="app.js"></script>
  </body>
</html>
